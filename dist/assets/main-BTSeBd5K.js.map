{"version":3,"file":"main-BTSeBd5K.js","sources":["../../main.js"],"sourcesContent":["import { ARAnimation } from './ar-animation.js';\nimport { QRCodeTracker } from './qr-tracker.js';\nimport { ImageTracker } from './image-tracker.js';\n\nconsole.log('AR应用开始加载...');\n\n// 检查基本功能\nfunction checkBasicFeatures() {\n    console.log('检查基本功能...');\n    \n    // 检查DOM是否加载完成\n    if (document.readyState === 'loading') {\n        console.log('DOM还在加载中...');\n        return false;\n    }\n    \n    // 检查必要的元素是否存在\n    const startARBtn = document.getElementById('startAR');\n    const startScreen = document.getElementById('startScreen');\n    const arScreen = document.getElementById('arScreen');\n    const loadingScreen = document.getElementById('loadingScreen');\n    \n    console.log('UI元素检查:', {\n        startARBtn: !!startARBtn,\n        startScreen: !!startScreen,\n        arScreen: !!arScreen,\n        loadingScreen: !!loadingScreen\n    });\n    \n    if (!startARBtn || !startScreen || !arScreen || !loadingScreen) {\n        console.error('必要的UI元素未找到！');\n        return false;\n    }\n    \n    return true;\n}\n\n// 简化的AR应用类\nclass SimpleARApp {\n    constructor() {\n        console.log('初始化SimpleARApp...');\n        this.isInitialized = false;\n        this.init();\n    }\n\n    init() {\n        console.log('开始初始化...');\n        \n        if (!checkBasicFeatures()) {\n            console.error('基本功能检查失败');\n            return;\n        }\n        \n        this.initUI();\n        this.initEventListeners();\n        this.isInitialized = true;\n        console.log('SimpleARApp初始化完成');\n    }\n\n    initUI() {\n        console.log('初始化UI元素...');\n        this.startScreen = document.getElementById('startScreen');\n        this.arScreen = document.getElementById('arScreen');\n        this.loadingScreen = document.getElementById('loadingScreen');\n        this.startARBtn = document.getElementById('startAR');\n        this.backBtn = document.getElementById('backBtn');\n        this.captureBtn = document.getElementById('captureBtn');\n        this.status = document.getElementById('status');\n        this.video = document.getElementById('video');\n        this.canvas = document.getElementById('canvas');\n        \n        if (this.canvas) {\n            this.ctx = this.canvas.getContext('2d');\n        }\n        \n        console.log('UI元素初始化完成');\n    }\n\n    initEventListeners() {\n        console.log('初始化事件监听器...');\n        \n        // 开始AR按钮\n        if (this.startARBtn) {\n            console.log('添加开始AR按钮事件监听器');\n            this.startARBtn.addEventListener('click', (e) => {\n                console.log('开始AR按钮被点击！');\n                e.preventDefault();\n                this.startAR();\n            });\n        } else {\n            console.error('开始AR按钮未找到！');\n        }\n        \n        // 返回按钮\n        if (this.backBtn) {\n            this.backBtn.addEventListener('click', (e) => {\n                console.log('返回按钮被点击！');\n                e.preventDefault();\n                this.stopAR();\n            });\n        }\n        \n        // 拍照按钮\n        if (this.captureBtn) {\n            this.captureBtn.addEventListener('click', (e) => {\n                console.log('拍照按钮被点击！');\n                e.preventDefault();\n                this.capturePhoto();\n            });\n        }\n        \n        // 拍照相关事件\n        const saveBtn = document.getElementById('saveBtn');\n        const retakeBtn = document.getElementById('retakeBtn');\n        \n        if (saveBtn) {\n            saveBtn.addEventListener('click', (e) => {\n                e.preventDefault();\n                this.savePhoto();\n            });\n        }\n        \n        if (retakeBtn) {\n            retakeBtn.addEventListener('click', (e) => {\n                e.preventDefault();\n                this.retakePhoto();\n            });\n        }\n        \n        console.log('事件监听器初始化完成');\n    }\n\n    async startAR() {\n        console.log('开始启动AR...');\n        \n        try {\n            this.showLoading();\n            this.updateStatus('正在初始化摄像头...');\n            \n            // 检查摄像头支持\n            if (!navigator.mediaDevices || !navigator.mediaDevices.getUserMedia) {\n                throw new Error('浏览器不支持摄像头功能');\n            }\n            \n            // 请求摄像头权限\n            const stream = await this.requestCamera();\n            if (!stream) {\n                this.hideLoading();\n                return;\n            }\n\n            // 设置视频流\n            if (this.video) {\n                this.video.srcObject = stream;\n                await this.waitForVideoLoad();\n            }\n            \n            // 切换到AR界面\n            this.showARScreen();\n            this.updateStatus('摄像头已启动，请对准二维码或图片');\n            \n            console.log('AR启动成功');\n            \n        } catch (error) {\n            console.error('AR启动失败:', error);\n            this.hideLoading();\n            this.showError('无法启动摄像头: ' + error.message);\n        }\n    }\n\n    async requestCamera() {\n        try {\n            console.log('请求摄像头权限...');\n            \n            const constraints = {\n                video: {\n                    facingMode: 'environment',\n                    width: { ideal: 1280 },\n                    height: { ideal: 720 }\n                }\n            };\n\n            const stream = await navigator.mediaDevices.getUserMedia(constraints);\n            console.log('摄像头权限获取成功');\n            return stream;\n            \n        } catch (error) {\n            console.error('摄像头权限获取失败:', error);\n            \n            let errorMessage = '摄像头启动失败';\n            \n            switch (error.name) {\n                case 'NotAllowedError':\n                    errorMessage = '摄像头权限被拒绝，请在浏览器设置中允许摄像头访问';\n                    break;\n                case 'NotFoundError':\n                    errorMessage = '未找到摄像头设备';\n                    break;\n                case 'NotSupportedError':\n                    errorMessage = '您的浏览器不支持摄像头功能';\n                    break;\n                case 'NotReadableError':\n                    errorMessage = '摄像头被其他应用占用';\n                    break;\n                case 'OverconstrainedError':\n                    errorMessage = '摄像头不支持请求的分辨率';\n                    break;\n                default:\n                    errorMessage = '摄像头启动失败: ' + error.message;\n            }\n            \n            this.showError(errorMessage);\n            return null;\n        }\n    }\n\n    waitForVideoLoad() {\n        return new Promise((resolve, reject) => {\n            if (!this.video) {\n                reject(new Error('视频元素不存在'));\n                return;\n            }\n            \n            const timeout = setTimeout(() => {\n                reject(new Error('视频加载超时'));\n            }, 10000);\n            \n            if (this.video.readyState >= 2) {\n                clearTimeout(timeout);\n                resolve();\n            } else {\n                this.video.addEventListener('loadeddata', () => {\n                    clearTimeout(timeout);\n                    resolve();\n                }, { once: true });\n                \n                this.video.addEventListener('error', (error) => {\n                    clearTimeout(timeout);\n                    reject(error);\n                }, { once: true });\n            }\n        });\n    }\n\n    stopAR() {\n        console.log('停止AR...');\n        \n        // 停止视频流\n        if (this.video && this.video.srcObject) {\n            const tracks = this.video.srcObject.getTracks();\n            tracks.forEach(track => {\n                track.stop();\n                console.log('停止视频轨道:', track.kind);\n            });\n            this.video.srcObject = null;\n        }\n        \n        // 切换回启动界面\n        this.showStartScreen();\n        console.log('AR已停止');\n    }\n\n    capturePhoto() {\n        console.log('拍照功能...');\n        alert('拍照功能开发中...');\n    }\n\n    savePhoto() {\n        console.log('保存照片...');\n        alert('保存功能开发中...');\n    }\n\n    showLoading() {\n        if (this.loadingScreen) {\n            this.loadingScreen.classList.remove('hidden');\n            this.startScreen.classList.add('hidden');\n            this.arScreen.classList.add('hidden');\n        }\n    }\n\n    hideLoading() {\n        if (this.loadingScreen) {\n            this.loadingScreen.classList.add('hidden');\n        }\n    }\n\n    showStartScreen() {\n        if (this.startScreen) {\n            this.startScreen.classList.remove('hidden');\n            this.arScreen.classList.add('hidden');\n            this.loadingScreen.classList.add('hidden');\n        }\n    }\n\n    showARScreen() {\n        if (this.arScreen) {\n            this.arScreen.classList.remove('hidden');\n            this.startScreen.classList.add('hidden');\n            this.loadingScreen.classList.add('hidden');\n        }\n    }\n\n    updateStatus(message) {\n        console.log('状态更新:', message);\n        if (this.status) {\n            const statusText = this.status.querySelector('.status-text');\n            if (statusText) {\n                statusText.textContent = message;\n            }\n        }\n    }\n\n    showError(message) {\n        console.error('错误:', message);\n        alert(message);\n        this.hideLoading();\n        this.showStartScreen();\n    }\n}\n\n// 页面加载完成后初始化应用\nfunction initApp() {\n    console.log('页面加载完成，开始初始化应用...');\n    \n    // 延迟一点确保DOM完全加载\n    setTimeout(() => {\n        try {\n            window.arApp = new SimpleARApp();\n            console.log('AR应用初始化完成');\n        } catch (error) {\n            console.error('AR应用初始化失败:', error);\n            alert('应用初始化失败: ' + error.message);\n        }\n    }, 100);\n}\n\n// 监听页面加载事件\nif (document.readyState === 'loading') {\n    document.addEventListener('DOMContentLoaded', initApp);\n} else {\n    initApp();\n}\n\n// 导出应用实例供调试使用\nwindow.initARApp = initApp; "],"names":["checkBasicFeatures","startARBtn","startScreen","arScreen","loadingScreen","SimpleARApp","e","saveBtn","retakeBtn","stream","error","constraints","errorMessage","resolve","reject","timeout","track","message","statusText","initApp"],"mappings":"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"}