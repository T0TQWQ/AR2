(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))s(i);new MutationObserver(i=>{for(const a of i)if(a.type==="childList")for(const o of a.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&s(o)}).observe(document,{childList:!0,subtree:!0});function e(i){const a={};return i.integrity&&(a.integrity=i.integrity),i.referrerPolicy&&(a.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?a.credentials="include":i.crossOrigin==="anonymous"?a.credentials="omit":a.credentials="same-origin",a}function s(i){if(i.ep)return;i.ep=!0;const a=e(i);fetch(i.href,a)}})();class k{constructor(){this.canvas=null,this.isVisible=!1,this.isRunning=!1,this.targetPosition={x:0,y:0},this.targetSize={width:100,height:100},this.frames=[],this.currentFrame=0,this.frameCount=0,this.fps=8,this.lastFrameTime=0,this.isLoaded=!1,this.ctx=null,this.animationId=null,this.cachedSizes=new Map,console.log("ARåŠ¨ç”»ç±»åˆå§‹åŒ–å®Œæˆ")}start(t,e,s){t&&(console.log("å¯åŠ¨ARåŠ¨ç”»..."),this.canvas=t,this.ctx=t.getContext("2d"),this.targetPosition=e||{x:0,y:0},this.targetSize=s||{width:100,height:100},this.isRunning||(this.isRunning=!0,this.isVisible=!0,this.lastFrameTime=performance.now(),this.animate()),console.log("ARåŠ¨ç”»å·²å¯åŠ¨"))}stop(){console.log("åœæ­¢ARåŠ¨ç”»..."),this.isRunning=!1,this.isVisible=!1,this.animationId&&(cancelAnimationFrame(this.animationId),this.animationId=null),this.ctx&&this.canvas&&this.ctx.clearRect(0,0,this.canvas.width,this.canvas.height),console.log("ARåŠ¨ç”»å·²åœæ­¢")}animate(){if(!this.isRunning||!this.ctx||!this.canvas)return;const t=performance.now();t-this.lastFrameTime>=1e3/this.fps&&(this.currentFrame=(this.currentFrame+1)%this.frameCount,this.lastFrameTime=t),this.ctx.clearRect(0,0,this.canvas.width,this.canvas.height),this.drawCurrentFrame(),this.animationId=requestAnimationFrame(()=>this.animate())}drawCurrentFrame(){if(!this.isLoaded||this.frames.length===0){console.log("åŠ¨ç”»æœªåŠ è½½å®Œæˆï¼Œè·³è¿‡ç»˜åˆ¶",{isLoaded:this.isLoaded,framesCount:this.frames.length,currentFrame:this.currentFrame}),this.ctx&&this.canvas&&(this.ctx.fillStyle="rgba(255, 0, 0, 0.8)",this.ctx.fillRect(10,10,300,60),this.ctx.fillStyle="white",this.ctx.font="16px Arial",this.ctx.fillText("åŠ¨ç”»æœªåŠ è½½",20,35),this.ctx.fillText(`å·²åŠ è½½: ${this.frames.filter(s=>s).length}/${this.frameCount}`,20,55));return}const t=this.frames[this.currentFrame];if(!t){console.log("å½“å‰å¸§ä¸å­˜åœ¨",{currentFrame:this.currentFrame,totalFrames:this.frameCount,frames:this.frames.map(s=>s?"loaded":"null")}),this.ctx&&this.canvas&&(this.ctx.fillStyle="rgba(255, 165, 0, 0.8)",this.ctx.fillRect(10,10,300,60),this.ctx.fillStyle="white",this.ctx.font="16px Arial",this.ctx.fillText("å½“å‰å¸§ä¸å­˜åœ¨",20,35),this.ctx.fillText(`å¸§${this.currentFrame} / æ€»${this.frameCount}`,20,55));return}const e=this.getCachedDrawInfo(t);this.ctx.drawImage(t,e.x,e.y,e.width,e.height)}drawCurrentFrameToContext(t,e,s){if(!this.isLoaded||this.frames.length===0){console.log("åŠ¨ç”»æœªåŠ è½½å®Œæˆï¼Œè·³è¿‡ç»˜åˆ¶åˆ°ç›®æ ‡context");return}const i=this.frames[this.currentFrame];if(!i){console.log("å½“å‰å¸§ä¸å­˜åœ¨ï¼Œè·³è¿‡ç»˜åˆ¶åˆ°ç›®æ ‡context");return}const a=this.targetPosition.x,o=this.targetPosition.y,n=120,h=Math.max(this.targetSize.width,this.targetSize.height),c=Math.max(n,h*1),r=i.width,l=i.height,m=Math.min(c/r,c/l),d=r*m,f=l*m,w=a-d/2,p=o-f/2;let g=Math.max(10,Math.min(w,e-d-10)),u=Math.max(10,Math.min(p,s-f-10));t.drawImage(i,g,u,d,f),console.log("åŠ¨ç”»å¸§å·²ç»˜åˆ¶åˆ°ç›®æ ‡context",{frame:this.currentFrame,position:{x:g,y:u,width:d,height:f},targetCanvasSize:`${e}x${s}`})}getCachedDrawInfo(t){const e=`${t.width}-${t.height}-${this.targetSize.width}-${this.targetSize.height}`;if(this.cachedSizes.has(e))return this.cachedSizes.get(e);const s=this.targetPosition.x,i=this.targetPosition.y,a=120,o=Math.max(this.targetSize.width,this.targetSize.height),n=Math.max(a,o*1),h=t.width,c=t.height,r=Math.min(n/h,n/c),l=h*r,m=c*r,d=s-l/2,f=i-m/2,w=window.innerWidth,p=window.innerHeight;let g=Math.max(10,Math.min(d,w-l-10)),u=Math.max(10,Math.min(f,p-m-10));const y={x:g,y:u,width:l,height:m};return this.cachedSizes.set(e,y),y}loadFrames(){return new Promise((t,e)=>{const s=["./images/GIF1.png","./images/GIF2.png","./images/GIF3.png","./images/GIF4.png"];let i=0,a=0;const o=s.length;console.log("å¼€å§‹åŠ è½½PNGåŠ¨ç”»å¸§...",s);const n=setTimeout(()=>{i<o&&(console.error("åŠ¨ç”»åŠ è½½è¶…æ—¶ï¼Œå·²åŠ è½½:",i,"/",o),e(new Error("åŠ¨ç”»åŠ è½½è¶…æ—¶")))},5e3);s.forEach((h,c)=>{const r=new Image;r.onload=()=>{i++,console.log(`âœ… å¸§${c+1}åŠ è½½æˆåŠŸ:`,h,`(${r.width}x${r.height})`),this.frames[c]=r,i===o&&(clearTimeout(n),this.frameCount=o,this.isLoaded=!0,console.log("ğŸ‰ æ‰€æœ‰åŠ¨ç”»å¸§åŠ è½½å®Œæˆ!",{totalFrames:this.frameCount,frames:this.frames.map(l=>l?`${l.width}x${l.height}`:"null")}),t())},r.onerror=l=>{a++,console.error(`âŒ å¸§${c+1}åŠ è½½å¤±è´¥:`,h,l),this.frames[c]=null,a===o&&(clearTimeout(n),console.error("æ‰€æœ‰åŠ¨ç”»å¸§åŠ è½½å¤±è´¥"),e(new Error("æ‰€æœ‰åŠ¨ç”»å¸§åŠ è½½å¤±è´¥")))},r.crossOrigin="anonymous",r.src=h,console.log(`ğŸ”„ å¼€å§‹åŠ è½½å¸§${c+1}:`,h)})})}loadGif(t){return console.log("æ£€æµ‹åˆ°GIFè·¯å¾„ï¼Œè‡ªåŠ¨åˆ‡æ¢åˆ°PNGé€å¸§åŠ¨ç”»æ¨¡å¼"),this.loadFrames()}init(){console.log("ARåŠ¨ç”»åˆå§‹åŒ–å®Œæˆ")}showAnimation(t,e){this.start(null,t,e)}hideAnimation(){this.stop()}update(){}dispose(){this.stop(),this.frames=[],this.isLoaded=!1,this.cachedSizes.clear(),console.log("ARåŠ¨ç”»èµ„æºå·²æ¸…ç†")}}class C{constructor(){this.lastDetection=null,this.detectionTimeout=500,this.templates=[],this.threshold=.15,this.debugMode=!1,this.lastDetectionTime=0,this.detectionInterval=250,this.isInitialized=!1,this.detectionCache=new Map,this.cacheTimeout=1e3,setTimeout(()=>{this.isInitialized=!0,console.log("å›¾ç‰‡è¿½è¸ªå™¨å»¶è¿Ÿåˆå§‹åŒ–å®Œæˆ")},200)}addTemplate(t,e="template"){return new Promise((s,i)=>{const a=new Image;a.crossOrigin="anonymous";const o=setTimeout(()=>{i(new Error("å›¾ç‰‡åŠ è½½è¶…æ—¶"))},2e3);a.onload=()=>{clearTimeout(o);const n=document.createElement("canvas"),h=n.getContext("2d"),c=150,r=Math.min(c/a.width,c/a.height,1);n.width=a.width*r,n.height=a.height*r,h.drawImage(a,0,0,n.width,n.height);const l=h.getImageData(0,0,n.width,n.height);this.templates.push({name:e,imageData:l,width:n.width,height:n.height}),console.log(`æ¨¡æ¿å›¾ç‰‡ "${e}" æ·»åŠ æˆåŠŸï¼Œå°ºå¯¸: ${n.width}x${n.height}`),s()},a.onerror=n=>{clearTimeout(o),console.error(`æ¨¡æ¿å›¾ç‰‡ "${e}" åŠ è½½å¤±è´¥:`,n),i(n)},a.src=t})}async detect(t,e,s){try{const i=Date.now();if(i-this.lastDetectionTime<this.detectionInterval)return this.lastDetection?this.lastDetection.result:{detected:!1};this.lastDetectionTime=i;const a=`${e}x${s}`,o=this.detectionCache.get(a);if(o&&i-o.timestamp<this.cacheTimeout)return o.result;if(this.lastDetection&&i-this.lastDetection.timestamp<this.detectionTimeout)return this.lastDetection.result;const n=t.getImageData(0,0,e,s);for(const c of this.templates){const r=this.matchTemplateOptimized(n,c,e,s);if(r&&r.confidence>this.threshold){const l={detected:!0,type:"image",name:c.name,position:r.position,size:r.size,confidence:r.confidence};return this.detectionCache.set(a,{timestamp:i,result:l}),this.lastDetection={timestamp:i,result:l},console.log(`âœ… æ£€æµ‹åˆ°å›¾ç‰‡ "${c.name}"ï¼ŒåŒ¹é…åº¦: ${r.confidence.toFixed(3)}`),l}}this.lastDetection&&i-this.lastDetection.timestamp>this.detectionTimeout&&(this.lastDetection=null);const h={detected:!1};return this.detectionCache.set(a,{timestamp:i,result:h}),h}catch(i){return console.error("å›¾ç‰‡æ£€æµ‹é”™è¯¯:",i),{detected:!1}}}matchTemplateOptimized(t,e,s,i){const a=e.width,o=e.height;if(a>s||o>i)return null;let n=null,h=0;const c=Math.max(3,Math.floor(Math.min(a,o)/20)),r=Math.min(80,Math.floor(Math.min(s,i)*.08)),l=r,m=r,d=s-a-r,f=i-o-r,w=100;let p=0;for(let g=m;g<=f&&p<w;g+=c)for(let u=l;u<=d&&p<w;u+=c){p++;const y=this.calculateSimilarityFast(t,e.imageData,u,g,s,0,0,a,a,o);if(y>h&&(h=y,n={position:{x:u,y:g},size:{width:a,height:o},confidence:y},y>.8))return n}return n}calculateSimilarityFast(t,e,s,i,a,o,n,h,c,r){let l=0,m=0;const d=Math.max(1,Math.floor(Math.min(c,r)/10));for(let w=0;w<r;w+=d)for(let p=0;p<c;p+=d){const g=((i+w)*a+(s+p))*4,u=((n+w)*h+(o+p))*4,y=Math.abs(t.data[g]-e.data[u]),T=Math.abs(t.data[g+1]-e.data[u+1]),I=Math.abs(t.data[g+2]-e.data[u+2]);l+=(y+T+I)/3,m++}if(m===0)return 0;const f=l/m;return Math.max(0,1-f/255)}matchTemplate(t,e,s,i){return this.matchTemplateOptimized(t,e,s,i)}calculateSimilarity(t,e,s,i,a,o,n,h,c,r){return this.calculateSimilarityFast(t,e,s,i,a,o,n,h,c,r)}detectSimple(t,e,s){try{const i=t.getImageData(0,0,e,s),a=this.findHighContrastRegions(i,e,s);for(const o of a)if(this.isImageLike(o,i,e,s))return{detected:!0,type:"simple",position:{x:o.x,y:o.y},size:{width:o.width,height:o.height},confidence:.5};return{detected:!1}}catch(i){return console.error("ç®€åŒ–æ£€æµ‹é”™è¯¯:",i),{detected:!1}}}findHighContrastRegions(t,e,s){const i=[];for(let n=0;n<s-50;n+=25)for(let h=0;h<e-50;h+=25){const c=this.calculateRegionContrast(t,h,n,50,e);c>30&&i.push({x:h,y:n,width:50,height:50,contrast:c})}return i.sort((n,h)=>h.contrast-n.contrast).slice(0,3)}calculateRegionContrast(t,e,s,i,a){let o=255,n=0;for(let h=0;h<i;h++)for(let c=0;c<i;c++){const r=((s+h)*a+(e+c))*4,l=(t.data[r]+t.data[r+1]+t.data[r+2])/3;o=Math.min(o,l),n=Math.max(n,l)}return n-o}isImageLike(t,e,s,i){return this.calculateEdgeDensity(e,t.x,t.y,t.width,t.height,s)>.1}calculateEdgeDensity(t,e,s,i,a,o){let n=0,h=0;for(let c=1;c<a-1;c++)for(let r=1;r<i-1;r++){const l=((s+c)*o+(e+r))*4,m=(t.data[l]+t.data[l+1]+t.data[l+2])/3,d=((s+c)*o+(e+r-1))*4,f=(t.data[d]+t.data[d+1]+t.data[d+2])/3;Math.abs(m-f)>20&&n++,h++}return h>0?n/h:0}dispose(){this.templates=[],this.detectionCache.clear(),this.lastDetection=null,console.log("å›¾ç‰‡è¿½è¸ªå™¨èµ„æºå·²æ¸…ç†")}}console.log("ARåº”ç”¨å¼€å§‹åŠ è½½...");const x={enableFastStart:!0,resourceTimeout:2e3,detectionInterval:200,simpleDetection:!0,delayTrackerInit:500};function F(){if(console.log("æ£€æŸ¥åŸºæœ¬åŠŸèƒ½..."),document.readyState==="loading")return console.log("DOMè¿˜åœ¨åŠ è½½ä¸­..."),!1;const S=document.getElementById("startAR"),t=document.getElementById("startScreen"),e=document.getElementById("arScreen"),s=document.getElementById("loadingScreen");return console.log("UIå…ƒç´ æ£€æŸ¥:",{startARBtn:!!S,startScreen:!!t,arScreen:!!e,loadingScreen:!!s}),!S||!t||!e||!s?(console.error("å¿…è¦çš„UIå…ƒç´ æœªæ‰¾åˆ°ï¼"),!1):!0}class A{constructor(){console.log("åˆå§‹åŒ–OptimizedARApp..."),this.isInitialized=!1,this.isTracking=!1,this.animation=null,this.imageTracker=null,this.detectionCanvas=null,this.detectionCtx=null,this.resourcesLoaded=!1,this.init()}init(){if(console.log("å¼€å§‹å¿«é€Ÿåˆå§‹åŒ–..."),!F()){console.error("åŸºæœ¬åŠŸèƒ½æ£€æŸ¥å¤±è´¥"),this.hideLoading(),this.showError("åº”ç”¨åˆå§‹åŒ–å¤±è´¥ï¼šåŸºæœ¬åŠŸèƒ½æ£€æŸ¥å¤±è´¥");return}try{this.initUI(),this.initEventListeners(),x.enableFastStart&&(this.isInitialized=!0,this.hideLoading(),this.showStartScreen(),console.log("å¿«é€Ÿå¯åŠ¨å®Œæˆï¼Œç•Œé¢å·²æ˜¾ç¤º"),this.loadResourcesInBackground())}catch(t){console.error("åˆå§‹åŒ–è¿‡ç¨‹ä¸­å‡ºé”™:",t),this.hideLoading(),this.showError("åº”ç”¨åˆå§‹åŒ–å¤±è´¥: "+t.message)}}initUI(){console.log("åˆå§‹åŒ–UIå…ƒç´ ..."),this.startScreen=document.getElementById("startScreen"),this.arScreen=document.getElementById("arScreen"),this.loadingScreen=document.getElementById("loadingScreen"),this.startARBtn=document.getElementById("startAR"),this.backBtn=document.getElementById("backBtn"),this.captureBtn=document.getElementById("captureBtn"),this.status=document.getElementById("status"),this.video=document.getElementById("video"),this.canvas=document.getElementById("canvas"),this.canvas&&(this.ctx=this.canvas.getContext("2d")),this.detectionCanvas=document.createElement("canvas"),this.detectionCtx=this.detectionCanvas.getContext("2d"),console.log("UIå…ƒç´ åˆå§‹åŒ–å®Œæˆ")}async loadResourcesInBackground(){console.log("åå°åŠ è½½èµ„æº...");try{setTimeout(async()=>{await this.initTrackersAsync()},x.delayTrackerInit)}catch(t){console.error("åå°èµ„æºåŠ è½½å¤±è´¥:",t)}}async initTrackersAsync(){try{console.log("å¼€å§‹å¼‚æ­¥åˆå§‹åŒ–è¿½è¸ªå™¨...");const[t,e]=await Promise.allSettled([this.createImageTracker(),this.createAnimation()]);t.status==="fulfilled"&&(this.imageTracker=t.value,console.log("å›¾ç‰‡è¿½è¸ªå™¨åˆå§‹åŒ–æˆåŠŸ")),e.status==="fulfilled"&&(this.animation=e.value,console.log("åŠ¨ç”»ç»„ä»¶åˆå§‹åŒ–æˆåŠŸ")),this.resourcesLoaded=!0,console.log("ARç»„ä»¶åˆå§‹åŒ–å®Œæˆ")}catch(t){console.error("è¿½è¸ªå™¨åˆå§‹åŒ–å¤±è´¥:",t)}}async createImageTracker(){const t=new C;t.detectionInterval=x.detectionInterval,t.threshold=.15;try{await t.addTemplate("./images/marker.png","marker"),console.log("MarkeråŠ è½½æˆåŠŸ")}catch{console.log("MarkeråŠ è½½å¤±è´¥ï¼Œä½¿ç”¨å¤‡ç”¨æ–¹æ¡ˆ"),await this.addTestTemplate(t)}return t}async createAnimation(){const t=new k;console.log("åˆ›å»ºåŠ¨ç”»ç»„ä»¶...");try{await t.loadFrames(),console.log("PNGåŠ¨ç”»åŠ è½½æˆåŠŸ"),console.log("åŠ¨ç”»çŠ¶æ€:",{isLoaded:t.isLoaded,frameCount:t.frameCount,framesLength:t.frames.length,fps:t.fps})}catch(e){console.log("PNGåŠ¨ç”»åŠ è½½å¤±è´¥:",e.message)}return t}async addTestTemplate(t){try{const e=document.createElement("canvas"),s=e.getContext("2d");e.width=80,e.height=80,s.fillStyle="#FFFFFF",s.fillRect(0,0,80,80),s.strokeStyle="#000000",s.lineWidth=2,s.strokeRect(10,10,60,60),s.fillStyle="#000000",s.fillRect(25,25,30,30),e.toBlob(i=>{const a=URL.createObjectURL(i);t.addTemplate(a,"test-marker"),console.log("æµ‹è¯•æ¨¡æ¿æ·»åŠ æˆåŠŸ")})}catch(e){console.error("æ·»åŠ æµ‹è¯•æ¨¡æ¿å¤±è´¥:",e)}}initEventListeners(){console.log("åˆå§‹åŒ–äº‹ä»¶ç›‘å¬å™¨..."),this.startARBtn&&this.startARBtn.addEventListener("click",()=>this.startAR()),this.backBtn&&this.backBtn.addEventListener("click",()=>this.stopAR()),this.captureBtn&&this.captureBtn.addEventListener("click",()=>this.capturePhoto()),console.log("äº‹ä»¶ç›‘å¬å™¨åˆå§‹åŒ–å®Œæˆ")}async startAR(){console.log("å¼€å§‹ARä½“éªŒ..."),console.log("å½“å‰çŠ¶æ€:",{isInitialized:this.isInitialized,resourcesLoaded:this.resourcesLoaded,hasImageTracker:!!this.imageTracker,hasAnimation:!!this.animation}),this.isInitialized||console.log("åº”ç”¨æœªå®Œå…¨åˆå§‹åŒ–ï¼Œå°è¯•ç»§ç»­å¯åŠ¨...");try{if(this.showARScreen(),this.updateStatus("æ­£åœ¨å¯åŠ¨æ‘„åƒå¤´..."),!await this.requestCamera()){this.showError("æ— æ³•å¯åŠ¨æ‘„åƒå¤´ï¼Œè¯·æ£€æŸ¥æƒé™è®¾ç½®");return}this.updateStatus("æ‘„åƒå¤´å·²å¯åŠ¨ï¼Œç­‰å¾…è§†é¢‘åŠ è½½..."),await this.waitForVideoLoad(),this.imageTracker||(this.updateStatus("æ­£åœ¨å‡†å¤‡å›¾åƒè¯†åˆ«..."),await this.waitForTracker()),this.updateStatus("å¼€å§‹è¿½è¸ªmarker..."),this.startTracking()}catch(t){console.error("å¯åŠ¨ARå¤±è´¥:",t),this.showError("å¯åŠ¨ARå¤±è´¥: "+t.message)}}async waitForTracker(){return new Promise(t=>{const e=()=>{this.imageTracker?t():setTimeout(e,100)};e()})}startTracking(){this.isTracking||(this.isTracking=!0,this.trackFrame(),console.log("å¼€å§‹è¿½è¸ª"))}stopTracking(){this.isTracking=!1,this.animation&&this.animation.stop(),console.log("åœæ­¢è¿½è¸ª")}trackFrame(){if(!(!this.isTracking||!this.video||!this.canvas||!this.ctx))try{this.ctx.drawImage(this.video,0,0,this.canvas.width,this.canvas.height),this.detectMarker(),requestAnimationFrame(()=>this.trackFrame())}catch(t){console.error("è¿½è¸ªå¸§å¤„ç†é”™è¯¯:",t),this.stopTracking()}}async detectMarker(){if(!this.imageTracker){console.log("å›¾ç‰‡è¿½è¸ªå™¨æœªå‡†å¤‡å¥½ï¼Œè·³è¿‡æ£€æµ‹");return}if(!this.ctx){console.log("Canvasä¸Šä¸‹æ–‡æœªå‡†å¤‡å¥½ï¼Œè·³è¿‡æ£€æµ‹");return}try{const t=await this.imageTracker.detect(this.ctx,this.canvas.width,this.canvas.height);t&&t.detected?this.showAnimation(t):this.hideAnimation()}catch(t){console.error("æ£€æµ‹markeré”™è¯¯:",t)}}showAnimation(t){if(!this.animation){console.log("åŠ¨ç”»ç»„ä»¶ä¸å­˜åœ¨ï¼Œè·³è¿‡æ˜¾ç¤º");return}if(!this.canvas){console.log("Canvasä¸å­˜åœ¨ï¼Œè·³è¿‡æ˜¾ç¤º");return}if(!t||!t.position||!t.size){console.log("æ£€æµ‹ç»“æœæ•°æ®ä¸å®Œæ•´ï¼Œè·³è¿‡æ˜¾ç¤º");return}try{const e={x:t.position.x+t.size.width/2,y:t.position.y-t.size.height*.8},s={width:Math.max(t.size.width*1.5,150),height:Math.max(t.size.height*1.5,150)};console.log("å‡†å¤‡æ˜¾ç¤ºåŠ¨ç”»",{position:e,size:s,animationLoaded:this.animation.isLoaded,framesCount:this.animation.frames?this.animation.frames.length:0,frameCount:this.animation.frameCount,canvasSize:`${this.canvas.width}x${this.canvas.height}`}),this.animation.start(this.canvas,e,s),this.updateStatus("æ£€æµ‹åˆ°markerï¼Œæ˜¾ç¤ºåŠ¨ç”»")}catch(e){console.error("æ˜¾ç¤ºåŠ¨ç”»é”™è¯¯:",e),this.updateStatus("åŠ¨ç”»æ˜¾ç¤ºå¤±è´¥: "+e.message)}}hideAnimation(){this.animation&&this.animation.stop()}async requestCamera(){try{const t=await navigator.mediaDevices.getUserMedia({video:{width:{ideal:640},height:{ideal:480},facingMode:"environment"}});return this.video.srcObject=t,this.video.play(),console.log("æ‘„åƒå¤´å¯åŠ¨æˆåŠŸ"),!0}catch(t){return console.error("æ‘„åƒå¤´å¯åŠ¨å¤±è´¥:",t),!1}}waitForVideoLoad(){return new Promise((t,e)=>{const s=setTimeout(()=>{e(new Error("è§†é¢‘åŠ è½½è¶…æ—¶"))},5e3);this.video.onloadedmetadata=()=>{clearTimeout(s),this.canvas.width=this.video.videoWidth,this.canvas.height=this.video.videoHeight,console.log("è§†é¢‘åŠ è½½å®Œæˆ"),t()},this.video.onerror=i=>{clearTimeout(s),e(new Error("è§†é¢‘åŠ è½½å¤±è´¥"))}})}stopAR(){console.log("åœæ­¢ARä½“éªŒ..."),this.stopTracking(),this.video&&this.video.srcObject&&(this.video.srcObject.getTracks().forEach(e=>e.stop()),this.video.srcObject=null),this.showStartScreen(),this.updateStatus("ARä½“éªŒå·²åœæ­¢")}capturePhoto(){if(!(!this.canvas||!this.video))try{const t=document.createElement("canvas"),e=t.getContext("2d");t.width=this.canvas.width,t.height=this.canvas.height,e.drawImage(this.video,0,0,t.width,t.height),this.animation&&this.animation.isRunning&&this.animation.drawCurrentFrameToContext(e,t.width,t.height);const s=t.toDataURL("image/png"),i=document.createElement("a");i.download=`ar-photo-${Date.now()}.png`,i.href=s,i.click(),this.updateStatus("ç…§ç‰‡å·²ä¿å­˜ï¼ˆåŒ…å«å®Œæ•´èƒŒæ™¯å’ŒåŠ¨ç”»ï¼‰")}catch(t){console.error("æ‹ç…§å¤±è´¥:",t),this.updateStatus("æ‹ç…§å¤±è´¥")}}showLoading(){this.loadingScreen&&(this.loadingScreen.style.display="flex"),this.startScreen&&(this.startScreen.style.display="none"),this.arScreen&&(this.arScreen.style.display="none")}hideLoading(){this.loadingScreen&&(this.loadingScreen.style.display="none")}showStartScreen(){this.startScreen&&(this.startScreen.style.display="flex"),this.arScreen&&(this.arScreen.style.display="none"),this.loadingScreen&&(this.loadingScreen.style.display="none")}showARScreen(){this.arScreen&&(this.arScreen.style.display="flex"),this.startScreen&&(this.startScreen.style.display="none"),this.loadingScreen&&(this.loadingScreen.style.display="none")}updateStatus(t){this.status&&(this.status.textContent=t),console.log("çŠ¶æ€æ›´æ–°:",t)}showError(t){console.error("é”™è¯¯:",t),this.updateStatus("é”™è¯¯: "+t),setTimeout(()=>{this.updateStatus("")},3e3)}}function v(){if(console.log("å¼€å§‹åˆå§‹åŒ–ARåº”ç”¨..."),!navigator.mediaDevices||!navigator.mediaDevices.getUserMedia){alert("æ‚¨çš„æµè§ˆå™¨ä¸æ”¯æŒæ‘„åƒå¤´åŠŸèƒ½ï¼Œè¯·ä½¿ç”¨ç°ä»£æµè§ˆå™¨");return}window.arApp=new A}document.readyState==="loading"?document.addEventListener("DOMContentLoaded",v):v();
//# sourceMappingURL=main-C5ka9U43.js.map
