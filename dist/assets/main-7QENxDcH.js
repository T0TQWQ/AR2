(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))o(s);new MutationObserver(s=>{for(const r of s)if(r.type==="childList")for(const i of r.addedNodes)i.tagName==="LINK"&&i.rel==="modulepreload"&&o(i)}).observe(document,{childList:!0,subtree:!0});function t(s){const r={};return s.integrity&&(r.integrity=s.integrity),s.referrerPolicy&&(r.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?r.credentials="include":s.crossOrigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function o(s){if(s.ep)return;s.ep=!0;const r=t(s);fetch(s.href,r)}})();console.log("AR应用开始加载...");function c(){if(console.log("检查基本功能..."),document.readyState==="loading")return console.log("DOM还在加载中..."),!1;const n=document.getElementById("startAR"),e=document.getElementById("startScreen"),t=document.getElementById("arScreen"),o=document.getElementById("loadingScreen");return console.log("UI元素检查:",{startARBtn:!!n,startScreen:!!e,arScreen:!!t,loadingScreen:!!o}),!n||!e||!t||!o?(console.error("必要的UI元素未找到！"),!1):!0}class d{constructor(){console.log("初始化SimpleARApp..."),this.isInitialized=!1,this.init()}init(){if(console.log("开始初始化..."),!c()){console.error("基本功能检查失败");return}this.initUI(),this.initEventListeners(),this.isInitialized=!0,console.log("SimpleARApp初始化完成")}initUI(){console.log("初始化UI元素..."),this.startScreen=document.getElementById("startScreen"),this.arScreen=document.getElementById("arScreen"),this.loadingScreen=document.getElementById("loadingScreen"),this.startARBtn=document.getElementById("startAR"),this.backBtn=document.getElementById("backBtn"),this.captureBtn=document.getElementById("captureBtn"),this.status=document.getElementById("status"),this.video=document.getElementById("video"),this.canvas=document.getElementById("canvas"),this.canvas&&(this.ctx=this.canvas.getContext("2d")),console.log("UI元素初始化完成")}initEventListeners(){console.log("初始化事件监听器..."),this.startARBtn?(console.log("添加开始AR按钮事件监听器"),this.startARBtn.addEventListener("click",o=>{console.log("开始AR按钮被点击！"),o.preventDefault(),this.startAR()})):console.error("开始AR按钮未找到！"),this.backBtn&&this.backBtn.addEventListener("click",o=>{console.log("返回按钮被点击！"),o.preventDefault(),this.stopAR()}),this.captureBtn&&this.captureBtn.addEventListener("click",o=>{console.log("拍照按钮被点击！"),o.preventDefault(),this.capturePhoto()});const e=document.getElementById("saveBtn"),t=document.getElementById("retakeBtn");e&&e.addEventListener("click",o=>{o.preventDefault(),this.savePhoto()}),t&&t.addEventListener("click",o=>{o.preventDefault(),this.retakePhoto()}),console.log("事件监听器初始化完成")}async startAR(){console.log("开始启动AR...");try{if(this.showLoading(),this.updateStatus("正在初始化摄像头..."),!navigator.mediaDevices||!navigator.mediaDevices.getUserMedia)throw new Error("浏览器不支持摄像头功能");const e=await this.requestCamera();if(!e){this.hideLoading();return}this.video&&(this.video.srcObject=e,await this.waitForVideoLoad()),this.showARScreen(),this.updateStatus("摄像头已启动，请对准二维码或图片"),console.log("AR启动成功")}catch(e){console.error("AR启动失败:",e),this.hideLoading(),this.showError("无法启动摄像头: "+e.message)}}async requestCamera(){try{console.log("请求摄像头权限...");const e={video:{facingMode:"environment",width:{ideal:1280},height:{ideal:720}}},t=await navigator.mediaDevices.getUserMedia(e);return console.log("摄像头权限获取成功"),t}catch(e){console.error("摄像头权限获取失败:",e);let t="摄像头启动失败";switch(e.name){case"NotAllowedError":t="摄像头权限被拒绝，请在浏览器设置中允许摄像头访问";break;case"NotFoundError":t="未找到摄像头设备";break;case"NotSupportedError":t="您的浏览器不支持摄像头功能";break;case"NotReadableError":t="摄像头被其他应用占用";break;case"OverconstrainedError":t="摄像头不支持请求的分辨率";break;default:t="摄像头启动失败: "+e.message}return this.showError(t),null}}waitForVideoLoad(){return new Promise((e,t)=>{if(!this.video){t(new Error("视频元素不存在"));return}const o=setTimeout(()=>{t(new Error("视频加载超时"))},1e4);this.video.readyState>=2?(clearTimeout(o),e()):(this.video.addEventListener("loadeddata",()=>{clearTimeout(o),e()},{once:!0}),this.video.addEventListener("error",s=>{clearTimeout(o),t(s)},{once:!0}))})}stopAR(){console.log("停止AR..."),this.video&&this.video.srcObject&&(this.video.srcObject.getTracks().forEach(t=>{t.stop(),console.log("停止视频轨道:",t.kind)}),this.video.srcObject=null),this.showStartScreen(),console.log("AR已停止")}capturePhoto(){console.log("拍照功能..."),alert("拍照功能开发中...")}savePhoto(){console.log("保存照片..."),alert("保存功能开发中...")}showLoading(){this.loadingScreen&&(this.loadingScreen.classList.remove("hidden"),this.startScreen.classList.add("hidden"),this.arScreen.classList.add("hidden"))}hideLoading(){this.loadingScreen&&this.loadingScreen.classList.add("hidden")}showStartScreen(){this.startScreen&&(this.startScreen.classList.remove("hidden"),this.arScreen.classList.add("hidden"),this.loadingScreen.classList.add("hidden"))}showARScreen(){this.arScreen&&(this.arScreen.classList.remove("hidden"),this.startScreen.classList.add("hidden"),this.loadingScreen.classList.add("hidden"))}updateStatus(e){if(console.log("状态更新:",e),this.status){const t=this.status.querySelector(".status-text");t&&(t.textContent=e)}}showError(e){console.error("错误:",e),alert(e),this.hideLoading(),this.showStartScreen()}}function a(){console.log("页面加载完成，开始初始化应用..."),setTimeout(()=>{try{window.arApp=new d,console.log("AR应用初始化完成")}catch(n){console.error("AR应用初始化失败:",n),alert("应用初始化失败: "+n.message)}},100)}document.readyState==="loading"?document.addEventListener("DOMContentLoaded",a):a();window.initARApp=a;
//# sourceMappingURL=main-7QENxDcH.js.map
